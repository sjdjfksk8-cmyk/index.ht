<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mobile CS Shooter Prototype</title>
<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial;}
#menu{
 position:fixed;inset:0;background:#000c;
 display:flex;align-items:center;justify-content:center;
 flex-direction:column;color:#fff;gap:20px;
}
button{padding:12px 25px;font-size:18px;cursor:pointer;border-radius:6px;border:none;}
#mapSelect{display:none;flex-direction:column;gap:10px;}

/* мобильные кнопки */
#mobileControls{
 position:fixed;bottom:20px;left:20px;
 width:160px;height:160px;
}
.joyBtn{
 position:absolute;width:50px;height:50px;border-radius:50%;
 background:#ffffff55;border:2px solid #fff;
}
#up{top:0;left:55px;}
#down{bottom:0;left:55px;}
#left{left:0;top:55px;}
#right{right:0;top:55px;}

#shootBtn{
 position:fixed;bottom:40px;right:40px;
 width:90px;height:90px;border-radius:50%;
 background:#ff000080;border:2px solid #fff;font-size:18px;color:white;
}
#damage{
 position:fixed;top:20px;left:20px;
 color:white;font-size:22px;
}
</style>
</head>
<body>

<div id="menu">
 <div id="mainMenu">
  <h1>CS-Style Shooter</h1>
  <button onclick="openMaps()">Старт</button>
 </div>

 <div id="mapSelect">
  <h2>Выберите карту</h2>
  <button onclick="startGame('desert')">Пустыня</button>
  <button onclick="startGame('city')">Город</button>
 </div>
</div>

<div id="damage">HP: 100</div>

<div id="mobileControls">
 <div class="joyBtn" id="up"></div>
 <div class="joyBtn" id="down"></div>
 <div class="joyBtn" id="left"></div>
 <div class="joyBtn" id="right"></div>
</div>

<button id="shootBtn">FIRE</button>

<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene,camera,renderer,controls;
let enemy,playerHP=100;
let keys={};
let speed=0.12;
let canShoot=true;

let enemyState="patrol";
let attackRange=20;
let detectRange=35;
let patrolDir=1;

function openMaps(){
 document.getElementById("mainMenu").style.display="none";
 document.getElementById("mapSelect").style.display="flex";
}

function startGame(map){
 document.getElementById("menu").style.display="none";
 init(map);
 animate();
}

function init(map){
 scene=new THREE.Scene();
 scene.background=new THREE.Color(0x222222);

 camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
 renderer=new THREE.WebGLRenderer({antialias:true});
 renderer.setSize(innerWidth,innerHeight);
 document.body.appendChild(renderer.domElement);

 controls=new THREE.PointerLockControls(camera,document.body);
 document.body.addEventListener("click",()=>controls.lock());

 let floorGeo=new THREE.PlaneGeometry(200,200);
 let floorMat=new THREE.MeshStandardMaterial({color:map==="desert"?0xc2b280:0x666666});
 let floor=new THREE.Mesh(floorGeo,floorMat);
 floor.rotation.x=-Math.PI/2;
 scene.add(floor);

 let light=new THREE.DirectionalLight(0xffffff,1);
 light.position.set(10,20,10);
 scene.add(light);
 scene.add(new THREE.AmbientLight(0xffffff,0.4));

 camera.position.set(0,3,5);

 let enemyGeo=new THREE.BoxGeometry(1,2,1);
 let enemyMat=new THREE.MeshStandardMaterial({color:0xff0000});
 enemy=new THREE.Mesh(enemyGeo,enemyMat);
 enemy.position.set(0,2,-25);
 scene.add(enemy);

 window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
 });

 document.addEventListener("keydown",e=>keys[e.code]=true);
 document.addEventListener("keyup",e=>keys[e.code]=false);
}

// Движение
function movePlayer(){
 if(keys["KeyW"]||keys["mobileUp"]) controls.moveForward(speed);
 if(keys["KeyS"]||keys["mobileDown"]) controls.moveForward(-speed);
 if(keys["KeyA"]||keys["mobileLeft"]) controls.moveRight(-speed);
 if(keys["KeyD"]||keys["mobileRight"]) controls.moveRight(speed);
}

// ИИ
function enemyAI(){
 if(!enemy)return;

 let dist=enemy.position.distanceTo(camera.position);

 if(dist>detectRange){
  enemyState="patrol";
 }

 if(dist<=detectRange && dist>attackRange){
  enemyState="chase";
 }

 if(dist<=attackRange){
  enemyState="attack";
 }

 if(enemyState==="patrol"){
  enemy.position.x+=0.05*patrolDir;
  if(enemy.position.x>10||enemy.position.x<-10)patrolDir*=-1;
 }

 if(enemyState==="chase"){
  let dir=new THREE.Vector3();
  dir.subVectors(camera.position,enemy.position).normalize();
  enemy.position.add(dir.multiplyScalar(0.06));
 }

 if(enemyState==="attack"){
  shootPlayer();
 }
}

// Стрельба врага
function shootPlayer(){
 if(!canShoot)return;
 canShoot=false;
 playerHP-=10;
 document.getElementById("damage").innerText="HP: "+playerHP;
 if(playerHP<=0) alert("Вы проиграли!");
 setTimeout(()=>canShoot=true,700);
}

// Рендер
function animate(){
 requestAnimationFrame(animate);
 movePlayer();
 enemyAI();
 renderer.render(scene,camera);
}

/* ---- Мобильные кнопки ---- */
function bindMobile(id,key){
 document.getElementById(id).addEventListener("touchstart",()=>keys[key]=true);
 document.getElementById(id).addEventListener("touchend",()=>keys[key]=false);
}
bindMobile("up","mobileUp");
bindMobile("down","mobileDown");
bindMobile("left","mobileLeft");
bindMobile("right","mobileRight");

document.getElementById("shootBtn").addEventListener("touchstart",()=>alert("Пока заглушка стрельбы игрока"));

</script>
</body>
</html>
